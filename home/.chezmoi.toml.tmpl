{{/* os detection */}}
{{- $osid := .chezmoi.os -}}
{{- if hasKey .chezmoi.osRelease "id" -}}
{{-   $osid = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

{{/* environment detection */}}
{{- $codespaces := env "CODESPACES" | not | not -}}
{{- $wsl := (and (eq .chezmoi.os "linux") (.chezmoi.kernel.osrelease | lower | contains "microsoft")) -}}

{{/* email prompt */}}
{{- $email := "" -}}
{{- if stdinIsATTY -}}
{{-   $email = promptStringOnce . "email" "email" -}}
{{- end -}}

{{/* user flags */}}
{{- $headless := false -}}{{/* headless setup */}}
{{- $safe     := false -}}{{/* safe mode, i.e. no setup from external resources */}}
{{- $gaming   := false -}}{{/* gaming setup */}}
{{- if $codespaces -}}
{{-   $headless = true -}}
{{-   $safe = false -}}
{{-   $gaming = false -}}
{{- end -}}
{{- if $wsl -}}
{{-   $headless = true -}}
{{-   $gaming = false -}}
{{- end -}}
{{- if (and (not $headless) stdinIsATTY) -}}
{{-   $headless = promptBoolOnce . "headless" "headless" false -}}
{{- end -}}
{{- if (and (not $safe) stdinIsATTY) -}}
{{-   $safe = promptBoolOnce . "safe" "safe mode" false -}}
{{- end -}}
{{- if (and (not $gaming) stdinIsATTY) -}}
{{-   $gaming = promptBoolOnce . "gaming" "gaming setup" false -}}
{{- end -}}


sourceDir = {{ .chezmoi.sourceDir | quote }}

[data]
    # environment
    osid = {{ $osid | quote }}
    codespaces = {{ $codespaces }}
    wsl = {{ $wsl }}

    # flags
    headless = {{ $headless }}
    safe = {{ $safe }}
    gaming = {{ $gaming }}

    # variables
    email = {{ $email | quote }}
